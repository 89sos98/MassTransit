<?xml version="1.0" encoding="utf-8"?>
<project name="CUSTOM POST PACKAGE" default="go">
  <!-- Project UppercuT - http://projectuppercut.org -->
  <property name="build.config.settings" value="__NONE__" overwrite="false" />
  <include buildfile="${build.config.settings}" if="${file::exists(build.config.settings)}" />
  <property name="dirs.current" value="${directory::get-parent-directory(project::get-buildfile-path())}" />
  <property name="path.to.toplevel" value=".." />
  <property name="folder.build_scripts" value="build" overwrite="false" />
  <property name="dirs.build_scripts" value="${dirs.current}\${path.to.toplevel}\${folder.build_scripts}" />
  <property name="folder.build_scripts_custom" value="build.custom" overwrite="false" />
  <property name="dirs.build_scripts_custom" value="${dirs.current}\${path.to.toplevel}\${folder.build_scripts_custom}" />
  <property name="folder.code_build" value="build_output" overwrite="false" />
  <property name="dirs.build" value="${dirs.current}\${path.to.toplevel}\${folder.code_build}" />
  <property name="folder.code_drop" value="code_drop" overwrite="false" />
  <property name="dirs.drop" value="${dirs.current}\${path.to.toplevel}\${folder.code_drop}" overwrite="false" />
  <property name="folder.app.drop" value="${project.name}" overwrite="false" />
  <property name="folder.database" value="__DATABASE_FOLDER_NAME__" overwrite="false" />
  <property name="dirs.database" value="${dirs.current}\${path.to.toplevel}\${folder.database}" overwrite="false" />
  <property name="folder.reports" value="${project.name}.Reports" overwrite="false" />
  <property name="dirs.reports" value="${dirs.current}\${path.to.toplevel}\${folder.reports}" overwrite="false" />
  <property name="folder.file_server" value="file.server" overwrite="false" />
  <property name="dirs.file_server" value="${dirs.current}\${path.to.toplevel}\${folder.file_server}" overwrite="false" />
  <property name="folder.environment_files" value="environment.files" overwrite="false" />
  <property name="dirs.environment_files" value="${dirs.current}\${path.to.toplevel}\${folder.environment_files}" overwrite="false" />
  <property name="folder.deployment" value="deployment" overwrite="false" />
  <property name="dirs.deployment" value="${dirs.current}\${path.to.toplevel}\${folder.deployment}" overwrite="false" />
  <property name="folder.settings" value="settings" overwrite="false" />
  <property name="dirs.settings" value="${dirs.current}\${path.to.toplevel}\${folder.settings}" overwrite="false" />
  <property name="folder.documentation" value="docs" overwrite="false" />
  <property name="dirs.docs" value="${dirs.current}\${path.to.toplevel}\${folder.documentation}" overwrite="false" />
  <property name="folder.references" value="lib" overwrite="false" />
  <property name="dirs.lib" value="${dirs.current}\${path.to.toplevel}\${folder.references}" overwrite="false" />
  <property name="dirs.rh" value="${dirs.lib}\RoundhousE" overwrite="false" />
  
  <target name="go" depends="package_roundhouse, package_legacy, package_runtime, package_containers, package_transports, package_systemview, the_cleaner" />

  <target name="package_roundhouse">
    <echo message="Packaging roundhouse files to ${dirs.drop}\${folder.deployment}."/>
    <copy todir="${dirs.drop}\${folder.deployment}">
      <fileset basedir="${dirs.rh}">
        <include name="**/*.*" />
      </fileset>
    </copy>
    
    <move file="${dirs.drop}\${folder.deployment}\rh.exe" tofile="${dirs.drop}\${folder.deployment}\tools\rh.exe" />
  </target>
  <target name="package_legacy">
    <echo message="Packaging legacy support application to ${dirs.drop}\legacy."/>
    <copy todir="${dirs.drop}\legacy">
      <fileset basedir="${dirs.drop}\MassTransit">
        <include name="Antlr3.Runtime.dll" />
		<include name="Castle.Core.dll" />
		<include name="Castle.Core.xml" />
		<include name="Castle.DynamicProxy2.dll" />
		<include name="Castle.DynamicProxy2.xml" />
		<include name="FluentNHibernate.dll" />
		<include name="FluentNHibernate.xml" />
		<include name="Iesi.Collections.dll" />
		<include name="Iesi.Collections.xml" />
		<include name="log4net.dll" />
		<include name="log4net.xml" />
		<include name="Magnum.dll" />
		<include name="Magnum.pdb" />
		<include name="Magnum.xml" />
		<include name="Magnum.Infrastructure.dll" />
		<include name="Magnum.Infrastructure.pdb" />
		<include name="Magnum.Infrastructure.xml" />
		<include name="MassTransit.dll" />
		<include name="MassTransit.Infrastructure.dll" />
		<include name="MassTransit.Infrastructure.pdb" />
		<include name="MassTransit.LegacySupport.dll" />
		<include name="MassTransit.LegacySupport.log4net.xml" />
		<include name="MassTransit.LegacySupport.pdb" />
		<include name="MassTransit.StructureMapIntegration.XML" />
		<include name="MassTransit.StructureMapIntegration.dll" />
		<include name="MassTransit.StructureMapIntegration.pdb" />
		<include name="MassTransit.Transports.Msmq.XML" />
		<include name="MassTransit.Transports.Msmq.dll" />
		<include name="MassTransit.Transports.Msmq.pdb" />
		<include name="NHibernate.dll" />
		<include name="NHibernate.ByteCode.Castle.dll" />
		<include name="NHibernate.Linq.dll" />
		<include name="StructureMap.dll" />
		<include name="Topshelf.dll" />
      </fileset>
    </copy>
    <move todir="${dirs.drop}\legacy">
      <fileset basedir="${dirs.drop}\MassTransit">
		<include name="AutoMapper.dll" />
		<include name="MassTransit.LegacySupport.*" />
		<include name="LegacyRuntime.exe" />
		<include name="LegacyRuntime.exe.config" />
		<include name="LegacyRuntime.pdb" />
      </fileset>
    </move>
  </target>
  
   <target name="package_runtime">
    <echo message="Packaging runtime support application to ${dirs.drop}\runtime."/>
    <copy todir="${dirs.drop}\runtime">
      <fileset basedir="${dirs.drop}\MassTransit">
        <include name="Antlr3.Runtime.dll" />
		<include name="Castle.Core.dll" />
		<include name="Castle.Core.xml" />
		<include name="Castle.DynamicProxy2.dll" />
		<include name="Castle.DynamicProxy2.xml" />
		<include name="FluentNHibernate.dll" />
		<include name="FluentNHibernate.xml" />
		<include name="Iesi.Collections.dll" />
		<include name="Iesi.Collections.xml" />
		<include name="log4net.dll" />
		<include name="log4net.xml" />
		<include name="Magnum.dll" />
		<include name="Magnum.pdb" />
		<include name="Magnum.xml" />
		<include name="Magnum.Infrastructure.dll" />
		<include name="Magnum.Infrastructure.pdb" />
		<include name="Magnum.Infrastructure.xml" />
		<include name="MassTransit.dll" />
		<include name="MassTransit.Infrastructure.dll" />
		<include name="MassTransit.Infrastructure.pdb" />
		<include name="MassTransit.StructureMapIntegration.XML" />
		<include name="MassTransit.StructureMapIntegration.dll" />
		<include name="MassTransit.StructureMapIntegration.pdb" />
		<include name="MassTransit.Transports.Msmq.XML" />
		<include name="MassTransit.Transports.Msmq.dll" />
		<include name="MassTransit.Transports.Msmq.pdb" />
		<include name="NHibernate.dll" />
		<include name="NHibernate.ByteCode.Castle.dll" />
		<include name="NHibernate.Linq.dll" />
		<include name="StructureMap.dll" />
		<include name="Topshelf.dll" />
      </fileset>
    </copy>
	<move todir="${dirs.drop}\runtime">
      <fileset basedir="${dirs.drop}\MassTransit">

		<include name="MassTransit.RuntimeServices.log4net.xml" />
		<include name="MassTransit.RuntimeServices.exe" />
		<include name="MassTransit.RuntimeServices.exe.config" />
		<include name="MassTransit.RuntimeServices.pdb" />
      </fileset>
    </move>
  </target>
  
  <target name="package_containers">
    <echo message="Packaging Windsor Support to ${dirs.drop}\containers\windsor."/>
    <move todir="${dirs.drop}\containers\windsor">
      <fileset basedir="${dirs.drop}\MassTransit">
		<include name="Castle.*" />
		
		<include name="MassTransit.WindsorIntegration.*" />
      </fileset>
    </move>
	
	<echo message="Packaging StructureMap Support to ${dirs.drop}\containers\structuremap."/>
    <move todir="${dirs.drop}\containers\structuremap">
      <fileset basedir="${dirs.drop}\MassTransit">
		<include name="StructureMap.*" />
		
		<include name="MassTransit.StructureMapIntegration.*" />
      </fileset>
    </move>
	
	<echo message="Packaging Ninject Support to ${dirs.drop}\containers\ninject."/>
    <move todir="${dirs.drop}\containers\ninject">
      <fileset basedir="${dirs.drop}\MassTransit">
		<include name="Ninject.*" />
		
		<include name="MassTransit.NinjectIntegration.*" />
      </fileset>
    </move>
	
	<echo message="Packaging Unity Support to ${dirs.drop}\containers\unity." />
	<move todir="${dirs.drop}\containers.unity">
		<fileset basedir="${dirs.drop}\MassTransit">
			<include name="MassTransit.UnityIntegration.*" />
		</fileset>
	</move>
  </target>
  
  <target name="package_systemview">
  	<echo message="Packaging System View to ${dirs.drop}\systemview."/>
    <move todir="${dirs.drop}\systemview">
      <fileset basedir="${dirs.drop}\MassTransit">
		<include name="MassTransit.SystemView*" />
		<include name="WPFToolkit.*" />
      </fileset>
    </move>
  </target>
  
  <target name="package_transports">
  
    <echo message="Packaging RabbitMQ Support to ${dirs.drop}\transports\rabbitmq."/>
    <move todir="${dirs.drop}\transports\rabbitmq">
      <fileset basedir="${dirs.drop}\MassTransit">
		<include name="MassTransit.Transports.RabbitMq.*" />
		
		<include name="RabbitMQ.Client.*" />
      </fileset>
    </move>
	
	<echo message="Packaging MSMQ Support to ${dirs.drop}\transports\msmq."/>
    <move todir="${dirs.drop}\transports\msmq">
      <fileset basedir="${dirs.drop}\MassTransit">
		
		<include name="MassTransit.Transports.Msmq.*" />
		<include name="install_msmq.bat" />
      </fileset>
    </move>
	
	<echo message="Packaging NMS Support to ${dirs.drop}\transports\nms."/>
    <move todir="${dirs.drop}\transports\nms">
      <fileset basedir="${dirs.drop}\MassTransit">
		<include name="Ninject.*" />
		
		<include name="MassTransit.Transports.Nms.*" />
      </fileset>
    </move>
  </target>
  
  <target name="the_cleaner">
	<echo message="cleaning up the MassTransit directory" />
	<delete>
		<fileset basedir="${dirs.drop}\MassTransit">
			<include name="Topshelf.*" />
			<include name="*.sdf" />
			<include name="activemq.castle.xml" />
			<include name="loopback.castle.xml" />
			<include name="subscriptions.castle.xml" />
		</fileset>
	</delete>
	<delete dir="${dirs.drop}\MassTransit\Saga" />
  </target>
</project>