<?xml version="1.0" encoding="utf-8" ?>
<castle>
	<components>
		<component id="endpointToListenOn"
				   lifestyle="singleton"
				   service="MassTransit.ServiceBus.IEndpoint, MassTransit.ServiceBus"
				   type="MassTransit.ServiceBus.MSMQ.MsmqEndpoint, MassTransit.ServiceBus.MSMQ">
			<parameters>
				<uriString>msmq://localhost/test_subscriptions</uriString>
			</parameters>
		</component>

		
		
		<component id="serviceBus"
				   lifestyle="singleton"
				   service="MassTransit.ServiceBus.IServiceBus, MassTransit.ServiceBus"
				   type="MassTransit.ServiceBus.ServiceBus, MassTransit.ServiceBus">
			<parameters>
				<endpointToListenOn>${endpointToListenOn}</endpointToListenOn>
				<!-- Setter Injection -->
				<SubscriptionCache>${subscriptionCache}</SubscriptionCache>
			</parameters>
		</component>
		<component id="subscriptionCache"
				   service="MassTransit.ServiceBus.Subscriptions.ISubscriptionCache, MassTransit.ServiceBus"
				   type="MassTransit.ServiceBus.Subscriptions.LocalSubscriptionCache, MassTransit.ServiceBus">
		</component>


		<component id="suscriptionRepository"
				   service="MassTransit.ServiceBus.Subscriptions.ISubscriptionRepository, MassTransit.ServiceBus"
				   type="MassTransit.SubscriptionStorage.NHibernateSubscriptionStorage, MassTransit.SubscriptionStorage">
		</component>
		
		<!-- load all of the services here -->
		<component id="subscriptionManager"
				   lifestyle="singleton"
				   service="MassTransit.ServiceBus.IMessageService, MassTransit.ServiceBus"
				   type="MassTransit.ServiceBus.Subscriptions.SubscriptionService, MassTransit.ServiceBus">
		</component>
	</components>

	<facilities>
		<facility id="nhibernate" isWeb="false" type="Castle.Facilities.NHibernateIntegration.NHibernateFacility, Castle.Facilities.NHibernateIntegration">
			<factory id="nhibernate.factory">
				<settings>
					<item key="hibernate.connection.provider">
						NHibernate.Connection.DriverConnectionProvider
					</item>
					<item key="hibernate.connection.driver_class">
						NHibernate.Driver.SqlClientDriver
					</item>
					<item key="hibernate.connection.connection_string">
						Database=test;Server=localhost;Integrated Security=SSPI
					</item>
					<item key="hibernate.dialect">
						NHibernate.Dialect.MsSql2005Dialect
					</item>
				</settings>

				<assemblies>
					<assembly>MassTransit.SubscriptionStorage</assembly>
				</assemblies>
			</factory>
		</facility>
	</facilities>
</castle>